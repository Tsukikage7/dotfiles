" ============================================================================
" IdeaVim 配置 (GoLand, IntelliJ IDEA 等 JetBrains IDE)
" ============================================================================

" 加载共享的 Vim 配置
source ~/.vimrc.shared

" ============================================================================
" IdeaVim 特定设置
" ============================================================================

" 启用 IdeaVim 扩展
set ideajoin              " 智能 Join (J)
set idearefactormode=keep " 重构模式
set ideastatusicon=gray   " 状态栏图标

" 启用 IDE 功能集成
set ideamarks             " IDE 书签集成
set ideawrite=all         " 保存时同步所有文件

" ============================================================================
" IdeaVim 内置扩展 (无需额外安装)
" ============================================================================

" Surround 扩展 (快速添加/修改/删除成对符号)
" 用法:
"   ys{motion}{char} - 添加包围符号
"   cs{old}{new}     - 修改包围符号
"   ds{char}         - 删除包围符号
"   S{char}          - 在可视模式下添加包围符号
set surround

" Commentary 扩展 (快速注释)
" 用法:
"   gcc  - 注释当前行
"   gc{motion} - 注释选中内容
"   gcap - 注释段落
set commentary

" Multiple cursors 扩展 (多光标编辑)
" 用法:
"   <A-n> - 选择下一个相同单词
"   <A-x> - 跳过当前并选择下一个
"   <A-p> - 取消选择并回到上一个
set multiple-cursors

" Highlighted yank (复制高亮)
set highlightedyank
let g:highlightedyank_highlight_duration = "300"
let g:highlightedyank_highlight_color = "rgba(250, 189, 47, 0.5)"

" NERDTree 扩展 (文件树)
set NERDTree

" Exchange 扩展 (交换文本)
" 用法:
"   cx{motion} - 标记第一个交换目标
"   cx{motion} - 标记第二个交换目标并交换
"   cxc - 取消标记
set exchange

" Text objects 扩展
" 增强的文本对象支持
set argtextobj        " 参数文本对象: daa, cia
set textobj-entire    " 整个文件文本对象: dae, cie
set textobj-indent    " 缩进文本对象: dai, cii

" ReplaceWithRegister 扩展
" 用法: gr{motion} - 用寄存器内容替换
set ReplaceWithRegister

" ============================================================================
" 额外的 IdeaVim 插件 (可选,需要手动安装)
" ============================================================================
" 以下插件需要在 JetBrains Marketplace 中搜索并安装:
"
" 1. IdeaVim-EasyMotion
"    安装后启用: set easymotion
"    用法: <leader><leader>w, <leader><leader>f{char}
"
" 2. AceJump
"    安装后启用: set acejump
"    用法: <leader>j
"
" 3. IdeaVim-Quickscope
"    安装后启用: set quickscope
"
" 如果已安装,取消下面的注释:
" set easymotion
" set acejump
" set quickscope

" Which-key 插件 (键位提示 - 不建议启用,会有延迟)
" set which-key
" set notimeout

" ============================================================================
" IDE 操作映射
" ============================================================================

" ============================================================================
" 代码折叠 (Code Folding) - 与 Vim 标准保持一致
" ============================================================================
" 切换折叠
nnoremap za :action ExpandCollapseToggleAction<CR>
" 折叠当前块
nnoremap zc :action CollapseRegion<CR>
" 展开当前块
nnoremap zo :action ExpandRegion<CR>
" 递归折叠
nnoremap zC :action CollapseRegionRecursively<CR>
" 递归展开
nnoremap zO :action ExpandRegionRecursively<CR>
" 折叠所有
nnoremap zM :action CollapseAllRegions<CR>
" 展开所有
nnoremap zR :action ExpandAllRegions<CR>
" 跳转到下一个折叠
nnoremap zj :action GotoNextFold<CR>
" 跳转到上一个折叠
nnoremap zk :action GotoPreviousFold<CR>

" ============================================================================
" 文件操作
" ============================================================================
nnoremap <leader>ff :action GotoFile<CR>
nnoremap <leader>fr :action RecentFiles<CR>
nnoremap <leader>fc :action GotoClass<CR>
nnoremap <leader>fs :action GotoSymbol<CR>
nnoremap <leader>fa :action GotoAction<CR>

" 代码导航
nnoremap gd :action GotoDeclaration<CR>
nnoremap gi :action GotoImplementation<CR>
nnoremap gr :action FindUsages<CR>
nnoremap gt :action GotoTypeDeclaration<CR>
nnoremap gb :action Back<CR>
nnoremap gf :action Forward<CR>

" 代码操作
nnoremap <leader>ca :action ShowIntentionActions<CR>
nnoremap <leader>cr :action RenameElement<CR>
nnoremap <leader>cf :action ReformatCode<CR>
nnoremap <leader>co :action OptimizeImports<CR>
nnoremap <leader>cg :action Generate<CR>

" 重构操作
nnoremap <leader>re :action RenameElement<CR>
nnoremap <leader>rm :action ExtractMethod<CR>
nnoremap <leader>rv :action IntroduceVariable<CR>
nnoremap <leader>rf :action IntroduceField<CR>
nnoremap <leader>rc :action IntroduceConstant<CR>
nnoremap <leader>rp :action IntroduceParameter<CR>

" 运行和调试
nnoremap <leader>rr :action Run<CR>
nnoremap <leader>rc :action RunClass<CR>
nnoremap <leader>rd :action Debug<CR>
nnoremap <leader>rb :action ToggleLineBreakpoint<CR>

" 测试
nnoremap <leader>tt :action RunNearestTest<CR>
nnoremap <leader>tf :action RunTestsInFile<CR>
nnoremap <leader>ta :action RunAllTests<CR>

" 终端
nnoremap <leader>T :action ActivateTerminalToolWindow<CR>

" 窗口管理
nnoremap <leader>ww :action HideAllWindows<CR>
nnoremap <leader>we :action ActivateProjectToolWindow<CR>
nnoremap <leader>wt :action ActivateTerminalToolWindow<CR>
nnoremap <leader>wd :action ActivateDebugToolWindow<CR>
nnoremap <leader>wr :action ActivateRunToolWindow<CR>

" Git 操作
nnoremap <leader>gb :action Git.Branches<CR>
nnoremap <leader>gc :action CheckinProject<CR>
nnoremap <leader>gp :action Vcs.Push<CR>
nnoremap <leader>gu :action Vcs.UpdateProject<CR>
nnoremap <leader>gl :action Vcs.Show.Log<CR>

" 错误导航
nnoremap ]e :action GotoNextError<CR>
nnoremap [e :action GotoPreviousError<CR>

" 方法导航
nnoremap ]m :action MethodDown<CR>
nnoremap [m :action MethodUp<CR>

" 书签
nnoremap <leader>mm :action ToggleBookmark<CR>
nnoremap <leader>ml :action ShowBookmarks<CR>

" ============================================================================
" Go 语言特定 (GoLand)
" ============================================================================

" Go 测试
nnoremap <leader>gt :action Go.RunTestAtCursor<CR>
nnoremap <leader>gT :action Go.RunTestInFile<CR>
nnoremap <leader>gp :action Go.RunPackageTests<CR>

" Go 生成
nnoremap <leader>gi :action Go.Generate.Implement<CR>
nnoremap <leader>gs :action Go.Generate.Struct<CR>

" Go 工具
nnoremap <leader>gf :action Go.FillStruct<CR>
nnoremap <leader>ga :action Go.AddTags<CR>
nnoremap <leader>gd :action Go.RemoveTags<CR>
