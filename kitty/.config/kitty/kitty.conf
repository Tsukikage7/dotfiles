# ============================================
# Kitty 终端配置文件
# ============================================

# ============================================
# [主题配置]
# ============================================
# BEGIN_KITTY_THEME
# Everforest Dark - 温暖复古主题
include current-theme.conf
# END_KITTY_THEME

# ============================================
# [字体配置]
# ============================================

# [字体大小] 16 点
font_size 16

# [常规字体] LigaMonaco Nerd Font
font_family LigaMonaco Nerd Font

# [粗体字体]
bold_font LigaMonaco Nerd Font

# [斜体字体]
italic_font LigaMonaco Nerd Font

# [粗斜体字体]
bold_italic_font LigaMonaco Nerd Font

# ============================================
# [窗口配置]
# ============================================

# [隐藏窗口装饰] 仅隐藏标题栏，保留边框
hide_window_decorations titlebar-only

# [窗口内边距] 5 像素，与 wezterm 保持一致
window_padding_width 5

# [背景透明度] 0.92 = 与 wezterm 保持一致
background_opacity 0.92

# [背景模糊强度] 启用毛玻璃效果 (macOS)
# 值为 0 禁用，正整数启用 (1-64 范围)
background_blur 32

# [动态背景透明度] 允许通过快捷键调整透明度
dynamic_background_opacity yes

# [记住窗口大小] 重启时恢复上次的窗口尺寸
remember_window_size yes

# [传统全屏模式] 关闭，允许透明效果控制
macos_traditional_fullscreen no

# [菜单栏隐藏窗口标题] 更简洁的界面
macos_show_window_title_in_menubar no

# [关闭窗口时退出] 符合 macOS 习惯
macos_quit_when_last_window_closed yes

# [窗口关闭确认] 禁用退出确认对话框
confirm_os_window_close 0

# ============================================
# [标签栏配置] - 美化版
# ============================================

# [标签栏位置] 顶部
tab_bar_edge top

# [标签栏样式] fade 渐变样式 (简洁)
tab_bar_style fade

# [活动标签字体样式] 加粗
active_tab_font_style bold

# [非活动标签字体样式] 正常
inactive_tab_font_style normal

# [活动标签标题] 显示标题 (fish 已禁用自动标题，所以默认显示程序名)
tab_title_template "{title}"

# [标签栏最小标签数] 1个标签时也显示标签栏
tab_bar_min_tabs 1

# [标签栏边距] 紧凑设计
tab_bar_margin_width 0.0
tab_bar_margin_height 0.0 0.0

# [标签栏背景色] 使用主题背景色
tab_bar_background none

# ============================================
# [通知配置]
# ============================================

# [桌面通知] 命令完成时显示通知 (unfocused = 窗口不在前台时)
notify_on_cmd_finish unfocused

# ============================================
# [光标配置]
# ============================================

# [光标拖影] 启用光标轨迹动画 (毫秒)
# 0 = 禁用，正数 = 光标静止超过该时间后才显示轨迹
cursor_trail 3

# [光标轨迹起始阈值] 光标移动超过多少格才显示轨迹
cursor_trail_start_threshold 2

# [光标轨迹衰减] 最快和最慢衰减时间 (秒)
cursor_trail_decay 0.1 0.4

# ============================================
# [交互行为]
# ============================================

# [选中即复制] 类 Unix 风格，复制到系统剪贴板
copy_on_select clipboard

# [滚动条指示器透明度] 显示滚动进度
scrollback_indicator_opacity 1.0

# ============================================
# [快捷键映射]
# ============================================

# [Kitty 修饰键] macOS 使用 cmd
kitty_mod cmd

# ------------------------------------------
# [标签管理]
# ------------------------------------------

# [Cmd+R] 设置标签页标题 (overlay)
map kitty_mod+r launch --type=overlay sh -c 'printf "Tab title: "; read title; [ -n "$title" ] && kitty @ set-tab-title "$title"'

# [Cmd+T] 创建新标签页并继承当前工作目录
map kitty_mod+t launch --type=tab --cwd=current

# [Cmd+数字] 快速跳转到指定标签页 1-10
map kitty_mod+1 goto_tab 1
map kitty_mod+2 goto_tab 2
map kitty_mod+3 goto_tab 3
map kitty_mod+4 goto_tab 4
map kitty_mod+5 goto_tab 5
map kitty_mod+6 goto_tab 6
map kitty_mod+7 goto_tab 7
map kitty_mod+8 goto_tab 8
map kitty_mod+9 goto_tab 9
map kitty_mod+0 goto_tab 10

# ------------------------------------------
# [鼠标操作]
# ------------------------------------------

# [Cmd+左键] 点击 URL 直接打开
mouse_map kitty_mod+left press ungrabbed,grabbed mouse_click_url

# ------------------------------------------
# [窗口操作]
# ------------------------------------------

# [Fn+F] 切换全屏模式
map fn+f toggle_fullscreen

# [Cmd+加号/减号] 动态调整背景透明度
map kitty_mod+plus set_background_opacity +0.05
map kitty_mod+minus set_background_opacity -0.05

# ------------------------------------------
# [tmux 快捷键转发]
# 通过 kitty 发送 tmux 命令 (Prefix = Ctrl+Space)
# ------------------------------------------

# [Cmd+[] 左右分屏
map kitty_mod+[ send_text all \x00|

# [Cmd+]] 上下分屏
map kitty_mod+] send_text all \x00-

# [Cmd+D] 断开会话
map kitty_mod+d send_text all \x00d

# [Cmd+W] 关闭窗格 (tmux 中关闭 tmux pane，否则关闭 kitty pane)
map kitty_mod+w combine : send_text all \x00x : close_window

# [Cmd+方向键] 切换窗格 (发送 Alt+方向键)
map kitty_mod+left send_text all \x1b[1;3D
map kitty_mod+right send_text all \x1b[1;3C
map kitty_mod+up send_text all \x1b[1;3A
map kitty_mod+down send_text all \x1b[1;3B

# [Cmd+N] 新建窗口
map kitty_mod+n send_text all \x00c

# [Cmd+,] 重命名窗口
map kitty_mod+, send_text all \x00,

# ------------------------------------------
# [搜索 - fzf 集成]
# ------------------------------------------

# [Cmd+F] 用 fzf 搜索滚动历史
map kitty_mod+f launch --type=overlay --stdin-source=@screen_scrollback fzf --no-sort --no-mouse --exact -i

# ============================================
# [Kittens 插件配置]
# ============================================

# ------------------------------------------
# [hints 智能提示]
# 功能：高亮终端中的 URL、路径、Git Hash 等
# ------------------------------------------

# [Cmd+E] 智能提示所有可点击内容
map kitty_mod+e kitten hints

# [Cmd+P F] 提取文件路径
map kitty_mod+p>f kitten hints --type path --program -

# [Cmd+P L] 提取整行内容
map kitty_mod+p>l kitten hints --type line --program -

# [Cmd+P W] 提取单词
map kitty_mod+p>w kitten hints --type word --program -

# [Cmd+P H] 提取 Git 提交哈希
map kitty_mod+p>h kitten hints --type hash --program -

# ------------------------------------------
# [unicode_input 字符输入]
# 功能：搜索并插入 Emoji、特殊符号等
# ------------------------------------------

# [Cmd+U] 打开 Unicode 字符输入器
map kitty_mod+u kitten unicode_input

# ------------------------------------------
# [clipboard 剪贴板历史]
# 功能：查看和管理剪贴板历史
# ------------------------------------------

# [Cmd+H] 查看剪贴板历史
map kitty_mod+h kitten clipboard --get-clipboard

# ------------------------------------------
# [其他实用 Kittens]
# 以下插件通过命令行使用
# ------------------------------------------

# [icat] 在终端内显示图片
# 使用: kitty +kitten icat image.png

# [themes] 主题切换器，实时预览
# 使用: kitty +kitten themes

# [diff] 侧边对比文件差异，比传统 diff 更美观
# 使用: kitty +kitten diff file1.txt file2.txt

# [ssh] 增强的 SSH，自动复制终端设置到远程
# 使用: kitty +kitten ssh user@host

# ============================================
# [远程控制]
# ============================================

# [允许远程控制] 用于自定义脚本
allow_remote_control yes

# ============================================
# [Shell 配置]
# ============================================

# [默认 Shell] Fish Shell - Homebrew 安装路径
shell /opt/homebrew/bin/fish

# [Shell 集成] 启用后新标签页继承当前工作目录
# no-title: 禁止 shell 自动设置标题（避免显示路径）
shell_integration no-title

# ============================================
# [性能优化]
# ============================================

# [重绘延迟] 5 毫秒，数值越小响应越快
repaint_delay 5

# [输入延迟] 0 毫秒，即时响应
input_delay 0

# ============================================
# [文件选择器 (choose-files kitten)]
# ============================================

# [Cmd+O] 打开快速文件选择器
map kitty_mod+o kitten choose-files

# [Cmd+Shift+O] 选择目录
map kitty_mod+shift+o kitten choose-files --only-dirs
